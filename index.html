<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <title>e-book | Home page</title>
  </head>
  <body>
    <header>
      <!-- header  -->
      <div class="navs container">
        <h1>e-Book</h1>
        <nav>
          <ul class="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">Books</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="login.html">WishList</a></li>
            <li><a href="register.html">Cart</a></li>
          </ul>
        </nav>
      </div>

      <!-- banner  -->
      <div style="background: #d0e1e7" class="">
        <div class="banner container">
          <div>
            <h2>Get Your New Book With The Best Price</h2>

            <div>
              <button class="btn-shop">Shop Now</button>
            </div>
          </div>

          <div class="banner-image">
            <img src="./assets/image/hero-girl.png" alt="" />
          </div>
        </div>
      </div>
    </header>

    <!-- main body  -->
    <main class="container main">
      <div style="margin: 100px auto">
        <div>
          <input
            type="text"
            placeholder="Search Book by title"
            class="search-field"
            name=""
            id=""
            onkeyup="searchBook(event)"
          />
        </div>
        <!-- skeleton loader  -->
        <div id="loader-container" class="loader-container-display"></div>
        <!-- end  -->

        <div id="book-container" class="book-container-display"></div>

        <div id="pagination-container">
          <button id="prev-button" disabled>Previous</button>
          <span id="page-info"></span>
          <button id="next-button">Next</button>
        </div>
      </div>
    </main>

    <script>
      let books;
      let currentPage = 1; // Initialize the current page
      const totalPages = 100; // Set a default total pages (gutendex API doesn't provide total pages)
      const prevButton = document.getElementById("prev-button");
      const nextButton = document.getElementById("next-button");
      const pageInfo = document.getElementById("page-info");
      const loadingElement = document.getElementById("loading");

      const bookContainer = document.getElementById("book-container");

      // Function to show loading cards
      const showLoaders = () => {
        const loaderContainer = document.getElementById("loader-container");

        // Clear any existing loaders
        loaderContainer.innerHTML = "";

        // Create 8 loader cards
        for (let i = 0; i < 8; i++) {
          const loaderCard = document.createElement("div");
          loaderCard.classList.add("card", "is-loading");
          loaderCard.innerHTML = `
            <div class="image"></div>
            <div class="content">
                <h2></h2>
                <h3></h3>
                <p></p>
            </div>`;

          // Append the loader card to the loader container
          loaderContainer.appendChild(loaderCard);
        }
      };

      const hideLoaders = () => {
        const loaderContainer = document.getElementById("loader-container");
        loaderContainer.innerHTML = ""; // Clear the loader cards
      };

      // Call this function before fetching data
      showLoaders();

      const fetchBooks = async (page) => {
        // Show loading cards
        showLoaders();

        const response = await fetch(
          `https://gutendex.com/books/?page=${page}`
        );
        books = await response.json();

        // Hide loading cards after fetching data
        hideLoaders();

        // Clear previous books
        bookContainer.innerHTML = "";

        books.results.forEach((book) => {
          const bookCard = document.createElement("div");
          bookCard.innerHTML = `
          
           <div class="book-card">
        <div class="image-container">
          <img
            src=${book.formats["image/jpeg"]}
            alt="Frankenstein Cover"
            class="book-cover"
          />
        </div>
        <div class="book-details">
          <h1 class="book-title">${book.title}</h1>
          <h2 class="book-author">by ${book.authors[0].name}</h2>
          <p class="book-id"><strong>ID:</strong> ${book.id}</p>
          <p class="book-genres">
            <strong>Genres:</strong> ${book.subjects.join(", ")}
          </p>
        </div>
      </div>
          
          `;

          bookContainer.appendChild(bookCard);
        });
        // Update page information
        updatePagination();
      };

      // Function to update pagination controls
      const updatePagination = () => {
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

        // Enable/disable buttons based on current page
        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage === totalPages;
      };

      // Event listeners for pagination buttons
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          fetchBooks(currentPage);
        }
      });

      nextButton.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          fetchBooks(currentPage);
        }
      });

      // Initial fetch for page 1
      fetchBooks(1);

      const searchBook = (e) => {
        const searchTerm = e.target.value;
        const filteredBooks = books.results.filter((book) =>
          book.title.toLowerCase().includes(searchTerm.toLowerCase())
        );
        console.log(filteredBooks);
        bookContainer.innerHTML = "";
        filteredBooks.forEach((book) => {
          const bookCard = document.createElement("div");
          bookCard.innerHTML = `
          
           <div class="book-card">
        <div class="image-container">
          <img
            src=${book.formats["image/jpeg"]}
            alt="Frankenstein Cover"
            class="book-cover"
          />
        </div>
        <div class="book-details">
          <h1 class="book-title">${book.title}</h1>
          <h2 class="book-author">by ${book.authors[0].name}</h2>
          <p class="book-id"><strong>ID:</strong> ${book.id}</p>
          <p class="book-genres">
            <strong>Genres:</strong> ${book.subjects.join(", ")}
          </p>
        </div>
      </div>
          
          `;

          bookContainer.appendChild(bookCard);
        });
      };
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="stylesheet" href="./assets/css/wishlist.css" />
    <title>E-book | Wishlist</title>
  </head>
  <body>
    <header>
      <!-- header  -->
      <div style="padding: 20px 0; height: 60px" class="navs container">
        <h1><a class="logo" href="index.html">e-Book</a></h1>
        <nav>
          <ul class="menu">
            <li><a href="index.html">Home</a></li>

            <li style="position: relative">
              <a href="wishlist.html">
                <svg
                  width="25px"
                  height="25px"
                  viewBox="0 0 64 64"
                  stroke-width="5"
                  stroke="#000000"
                  fill="none"
                >
                  <path
                    d="M9.06,25C7.68,17.3,12.78,10.63,20.73,10c7-.55,10.47,7.93,11.17,9.55a.13.13,0,0,0,.25,0c3.25-8.91,9.17-9.29,11.25-9.5C49,9.45,56.51,13.78,55,23.87c-2.16,14-23.12,29.81-23.12,29.81S11.79,40.05,9.06,25Z"
                  />
                </svg>
              </a>
              <span
                id="wishlist-count"
                style="
                  position: absolute;
                  right: -10px;
                  top: -10px;
                  font-weight: 700;
                "
                >5</span
              >
            </li>
          </ul>
        </nav>
      </div>
      <!-- banner  -->

      <div style="background: #d0e1e7">
        <div class="container wishlist-banner">
          <div class="book">
            <img src="./assets/image/book1.png" alt="" />
          </div>
          <div class="banner-text">
            <h1>WishList</h1>
            <ul class="breadcamp">
              <li><a href="index.html">Home</a></li>
              <li>></li>
              <li><a href="wishlist.html">Wishlist</a></li>
            </ul>
          </div>
          <div class="book">
            <img src="./assets//image/book2.png" alt="" />
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- wishlist  -->
      <div class="container table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Book Title</th>
              <th>ID</th>
              <th>Author</th>

              <th>Action</th>
            </tr>
          </thead>
          <tbody id="table-record-container"></tbody>
        </table>
        <div id="table-loader" class="table-loader-display"></div>
      </div>
    </main>

    <script>
      let items;
      const recordContainer = document.getElementById("table-record-container");

      // Function to show loading cards
      const showTableLoaders = () => {
        const loaderContainer = document.getElementById("table-loader");

        // Clear any existing loaders
        loaderContainer.innerHTML = "";

        // Create 8 loader cards
        for (let i = 0; i < 5; i++) {
          const loaderCard = document.createElement("div");
          loaderCard.classList.add("card-table", "is-loading");
          loaderCard.innerHTML = `
    
      <div class="content">
         
          <h4></h4>
      </div>`;

          // Append the loader card to the loader container
          loaderContainer.appendChild(loaderCard);
        }
      };

      const hideTableLoaders = () => {
        const loaderContainer = document.getElementById("table-loader");
        loaderContainer.innerHTML = ""; // Clear the loader cards
      };

      const fetchWishListItems = async () => {
        const wishlistItems = JSON.parse(localStorage.getItem("wishlist_item"));

        const wishlistIds = wishlistItems
          ? Object?.keys(wishlistItems)?.map(Number)
          : [];
        showTableLoaders();

        recordContainer.innerHTML = ""; // Clear previous books

        const response = await fetch(
          `https://gutendex.com/books?ids=${wishlistIds}`
        );
        items = await response.json();
        hideTableLoaders();

        items?.results?.forEach((book) => {
          const tr = document.createElement("tr");

          tr.innerHTML = `

              <td style="display:flex; align-items:center; gap:5px">

                 <img
                   style="height:50px; width:50px; "
                  src=${book.formats["image/jpeg"]}
                  alt="Frankenstein Cover"

                />
               <span> ${book.title.slice(0, 50)}</span>
                </td>
              <td>${book.id}</td>
              <td>${book?.authors[0]?.name}</td>

              <td onclick="handleDelete(${
                book.id
              })"> <img src="./assets/image/delete.svg" alt=""></td>

          `;

          recordContainer.appendChild(tr);
        });
      };

      fetchWishListItems();

      const handleDelete = (id) => {
        recordContainer.innerHTML = "";
        let wishlistItems = JSON.parse(localStorage.getItem("wishlist_item"));
        delete wishlistItems[id];

        const wishIds = wishlistItems
          ? Object.keys(wishlistItems).map(Number)
          : [];
        showWistListItems();
        localStorage.setItem("wishlist_item", JSON.stringify(wishlistItems));

        const filterItems = items?.results.filter((item) =>
          wishIds.includes(item.id)
        );

        filterItems?.forEach((book) => {
          const tr = document.createElement("tr");

          tr.innerHTML = `

              <td style="display:flex; align-items:center; gap:5px">

                 <img
                   style="height:50px; width:50px; "
                  src=${book.formats["image/jpeg"]}
                  alt="Frankenstein Cover"

                />
               <span> ${book.title.slice(0, 50)}</span>
                </td>
              <td>${book.id}</td>
              <td>${book?.authors[0]?.name}</td>

              <td onclick="handleDelete(${
                book.id
              })"> <img src="./assets/image/delete.svg" alt=""></td>

          `;

          recordContainer.appendChild(tr);
        });
      };

      showTableLoaders();

      const showWistListItems = () => {
        const wishlistItems = JSON.parse(localStorage.getItem("wishlist_item"));
        console.log(Object.keys(wishlistItems).length);
        document.getElementById("wishlist-count").innerText = wishlistItems
          ? Object.keys(wishlistItems).length
          : 0;
      };
      showWistListItems();
    </script>
  </body>
</html>
